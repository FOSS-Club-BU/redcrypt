{% extends 'base.html' %}
{% load static %}

{% block head_title %}{{title}}{% endblock %}

{% block head %}
<style>
.flip-clock {
  perspective: 1000px;
}

.flip-unit {
  position: relative;
  width: 100px;
  height: 100px;
  margin: 5px;
  background: rgba(0, 42, 42, 0.6);
  border-radius: 10px;
  perspective: 400px;
}

.flip-card {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.6s;
}

.flip-card.flip {
  transform: rotateX(-180deg);
}

.card-face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  font-weight: bold;
  border: 1px solid rgba(8, 183, 79, 0.3);
  background: rgba(0, 42, 42, 0.6);
  border-radius: 10px;
}

.card-face-back {
  transform: rotateX(180deg);
}

.unit-label {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-top: 0.5rem;
  color: #08B74F;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
</style>
{% endblock %}

{% block content %}
<div class="min-h-[80vh] flex items-center justify-center">
  <div class="max-w-4xl mx-auto px-4 py-10" data-aos="fade-up" data-aos-duration="800">
    <!-- Header Section -->
    <div class="text-center">
      <div class="w-20 h-20 mx-auto rounded-full bg-green-600/20 flex items-center justify-center mb-6 animate-pulse">
        <i class="ph-fill ph-timer text-4xl text-green-500"></i>
      </div>
      <h1 class="text-5xl md:text-6xl font-black text-neutral-100 mb-4">{{heading}}</h1>
      <p class="text-xl text-neutral-400 max-w-2xl mx-auto">{{subheading}}</p>
    </div>

    {% if time %}
    <!-- Countdown Section -->
    <div class="rounded-2xl p-8">
      <div class="flex flex-wrap justify-center gap-4" id="countdown-container">
        <!-- Days -->
        <div class="flip-clock text-center">
          <div class="flip-unit">
            <div class="flip-card" id="days-card">
              <div class="card-face text-green-500">00</div>
              <div class="card-face card-face-back text-green-500">00</div>
            </div>
          </div>
          <div class="unit-label">Days</div>
        </div>

        <!-- Hours -->
        <div class="flip-clock text-center">
          <div class="flip-unit">
            <div class="flip-card" id="hours-card">
              <div class="card-face text-green-500">00</div>
              <div class="card-face card-face-back text-green-500">00</div>
            </div>
          </div>
          <div class="unit-label">Hours</div>
        </div>

        <!-- Minutes -->
        <div class="flip-clock text-center">
          <div class="flip-unit">
            <div class="flip-card" id="minutes-card">
              <div class="card-face text-green-500">00</div>
              <div class="card-face card-face-back text-green-500">00</div>
            </div>
          </div>
          <div class="unit-label">Minutes</div>
        </div>

        <!-- Seconds -->
        <div class="flip-clock text-center">
          <div class="flip-unit">
            <div class="flip-card" id="seconds-card">
              <div class="card-face text-green-500">00</div>
              <div class="card-face card-face-back text-green-500">00</div>
            </div>
          </div>
          <div class="unit-label">Seconds</div>
        </div>
      </div>

      <div class="mt-12 text-center">
        <div class="inline-flex items-center gap-2 bg-green-600/20 px-6 py-3 rounded-full text-green-500">
          <i class="ph-fill ph-calendar text-xl"></i>
          <span class="text-sm font-medium" id="formatted-date">Starting {{time}}</span>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
function updateFlipCard(cardId, value) {
  const card = document.querySelector(`#${cardId}`);
  const currentValue = card.querySelector('.card-face').textContent;
  const paddedValue = value.toString().padStart(2, '0');
  
  if (currentValue !== paddedValue) {
    card.querySelector('.card-face').textContent = paddedValue;
    card.querySelector('.card-face-back').textContent = paddedValue;
    card.classList.add('flip');
    setTimeout(() => {
      card.classList.remove('flip');
    }, 600);
  }
}

var countDownDate = new Date("{{time}}").getTime();

// Format date for display
function formatDate(date) {
  const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric',
    hour: '2-digit', 
    minute: '2-digit',
  };
  return new Date(date).toLocaleDateString('en-US', options);
}

// Set formatted date in pill
document.getElementById('formatted-date').textContent = `Starting ${formatDate(countDownDate)}`;

var x = setInterval(function() {
  var now = new Date().getTime();
  var distance = countDownDate - now;

  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  updateFlipCard('days-card', days);
  updateFlipCard('hours-card', hours);
  updateFlipCard('minutes-card', minutes);
  updateFlipCard('seconds-card', seconds);

  if (distance < 0) {
    clearInterval(x);
    document.getElementById("countdown-container").innerHTML = `
      <div class="text-center p-8">
        <i class="ph-fill ph-confetti text-5xl text-green-500 mb-4"></i>
        <h2 class="text-2xl font-bold text-green-500">Hunt Started!</h2>
      </div>
    `;
    setTimeout(() => {
      window.location.reload();
    }, 2000);
  }
}, 1000);
</script>
{% endblock content %}