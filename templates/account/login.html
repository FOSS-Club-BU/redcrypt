{% extends "base.html" %}
{% load static %}
{% block head_title %}
  Login {% endblock head_title %}
  {% block head %}
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0" />
    <style>
  .errorlist {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.5rem;
  }

  .form-field {
    margin-bottom: 1.5rem;
  }

  /* Updated form input styling to match edit profile */
  .form-field input {
    width: 100%;
    background-color: rgba(23, 23, 23, 0.7);
    box-shadow: inset 0 2px 0px -0.5px rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(13.5px);
    color: #f1f1f1;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    border: 1px solid transparent;
    transition: all 0.3s;
  }

  .form-field input:focus {
    border-color: rgba(8, 183, 79, 0.5);
    outline: none;
    background-color: rgba(23, 23, 23, 0.8);
    transform: none;
  }

  .form-field input:not(:focus) {
    transform: translateY(0);
    transition: all 0.2s ease-out;
  }

  .form-field label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: #9ca3af;
    margin-bottom: 0.25rem;
  }

  .welcome-card {
    position: relative;
    overflow: hidden;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    border-right: 1px solid rgba(8, 183, 79, 0.2);
    min-height: auto; /* Remove the large min-height */
    animation: fadeIn 0.4s ease-out;
  }

  .welcome-card .content {
    position: relative;
    z-index: 1;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .welcome-card .logos {
    display: flex;
    justify-content: space-between;
    align-items: start;
    padding: 3rem;
  }

  .welcome-text {
    padding: 2rem;
    margin-top: auto;
  }

  .welcome-text h2 {
    font-size: 4rem;
    font-weight: 900;
    line-height: 1.1;
    color: #fff;
    text-align: left;
  }

  @media (max-width: 768px) {
    .welcome-card {
      border-right: none;
      border-bottom: 1px solid rgba(8, 183, 79, 0.2);
      margin-bottom: 0;
    }

    .welcome-text h2 {
      font-size: 2.5rem;
      text-align: center;
    }

    .welcome-text h2 span {
      display: inline;
      margin-right: 0.5rem;
    }

    .welcome-card .logos {
      padding: 2rem;
    }

    .form-container {
      padding-bottom: 2rem;
    }

    .form-field {
      margin-bottom: 2rem;
    }

    .form-content {
      padding-bottom: 2rem;
    }

    .form-buttons {
      position: relative;
      margin-top: 2rem;
      padding: 1.5rem;
    }
  }

  .gradient-text-green {
    background: linear-gradient(135deg, #08b74f 0%, #002a2a 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .form-container {
    display: flex;
    flex-direction: column;
    min-height: 100%;
    position: relative;
    padding-bottom: 5rem;
  }

  .form-content {
    flex: 1;
    animation: slideUp 0.3s ease-out;
  }

  .form-buttons {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1.5rem;
  }

  .step-header {
    margin-bottom: 2rem;
    text-align: center;
  }

  .form-fields {
    text-align: left;
  }

  .required-field label::after {
    content: " *";
    color: #ef4444;
  }

  .strength-meter {
    width: 90%;
    margin-top: 0.5rem;
    margin-left: auto;
    margin-right: auto;
    transition: opacity 0.3s;
    animation: strengthMeterAppear 0.3s ease-out forwards;
  }

  @keyframes strengthMeterAppear {
    0% {
      transform: translateY(-10px);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .strength-label {
    margin-bottom: 0.25rem;
    color: #08b74f;
    font-size: 0.875rem;
    transition: color 0.3s;
  }

  .strength-bars {
    display: flex;
    justify-content: space-between;
    gap: 3px;
  }

  .strength-bar {
    flex: 1;
    height: 6px;
    background-color: #ef4444;
    transition: width 0.3s, background-color 0.3s;
    border-radius: 999px;
  }

  .hidden {
    display: none;
  }

  .visible {
    display: block;
    opacity: 1;
  }

  .material-symbols-outlined#togglePassword1,
  .material-symbols-outlined#togglePassword2 {
    color: #aaa;
  }

  .custom-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .custom-checkbox input[type="checkbox"] {
    -webkit-appearance: none;
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #08b74f;
    border-radius: 6px;
    background: rgba(8, 183, 79, 0.1);
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
  }

  .custom-checkbox input[type="checkbox"]:checked {
    background: #08b74f;
  }

  .custom-checkbox input[type="checkbox"]:checked::after {
    content: "âœ“";
    color: black;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.875rem;
  }

  .custom-checkbox input[type="checkbox"]:focus {
    box-shadow: 0 0 0 2px rgba(8, 183, 79, 0.2);
  }

  .custom-checkbox label {
    cursor: pointer;
    user-select: none;
  }

  [data-aos] {
    transition-duration: 600ms !important;
  }

  .form-buttons button {
    background-color: rgba(23, 23, 23, 0.7);
    box-shadow: inset 0 2px 0px -0.5px rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(13.5px);
    border-radius: 0.75rem;
    border: 1px solid transparent;
    transition: all 0.2s ease-out;
  }

  .form-buttons button:hover {
    background-color: #08b74f;
    transform: translateY(-1px);
  }

  .form-buttons button:active {
    transform: translateY(0);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
    </style>
  {% endblock head %}
  {% block content %}
    <div class="justify-center px-4 py-8 flex items-center">
      <div class="max-w-5xl mx-auto flex items-stretch h-auto">
        <div class="bg-neutral-900/70 backdrop-blur-md shadow-inset-white rounded-2xl overflow-hidden flex-1 flex flex-col md:flex-row shadow-md">
          <div class="flex flex-col md:flex-row w-full">
            <!-- Welcome Card -->
            <div class="md:w-[400px] welcome-card hidden md:block"
                 data-aos="fade-right"
                 data-aos-duration="600">
              <svg width="100%"
                   height="100%"
                   viewBox="0 0 800 800"
                   style="position: absolute;
                          top: 0;
                          left: 0;
                          z-index: 0">
                <defs>
                <filter id="bb-filter" x="-100%" y="-100%" width="400%" height="400%">
                <feGaussianBlur stdDeviation="105" in="SourceGraphic" result="blur"></feGaussianBlur>
                </filter>
                </defs>
                <g filter="url(#bb-filter)">
                <ellipse rx="277.5" ry="70.5" cx="374" cy="152" fill="#08b74f"></ellipse>
                <ellipse rx="500" ry="70.5" cx="0" cy="800" fill="#2e90fa"></ellipse>
                </g>
              </svg>
              <div class="content">
                <div class="logos">
                  <img src="{% static 'foss-bu-dark.png' %}"
                       alt="FOSS BU"
                       class="h-8 md:h-12 w-auto"
                       width="auto"
                       height="auto" />
                  <img src="{% static 'logo.svg' %}"
                       alt="Re-Dcrypt"
                       class="h-8 md:h-12 w-auto"
                       width="auto"
                       height="auto" />
                </div>
                <div class="welcome-text">
                  <h2>
                    <span class="block text-white/80" id="welcomeText">Let's Log You In</span>
                  </h2>
                </div>
              </div>
            </div>
            <!-- Mobile Welcome Card -->
            <div class="md:hidden welcome-card"
                 data-aos="fade-down"
                 data-aos-duration="800">
              <svg width="100%"
                   height="100%"
                   viewBox="0 0 800 800"
                   style="position: absolute;
                          top: 0;
                          left: 0;
                          z-index: 0">
                <defs>
                <filter id="bb-filter" x="-100%" y="-100%" width="400%" height="400%">
                <feGaussianBlur stdDeviation="105" in="SourceGraphic" result="blur"></feGaussianBlur>
                </filter>
                </defs>
                <g filter="url(#bb-filter)">
                <ellipse rx="277.5" ry="70.5" cx="374" cy="152" fill="#08b74f"></ellipse>
                <ellipse rx="277.5" ry="70.5" cx="609" cy="577" fill="#2e90fa"></ellipse>
                </g>
              </svg>
              <div class="content">
                <div class="logos">
                  <img src="{% static 'foss-bu-dark.png' %}"
                       alt="FOSS BU"
                       class="h-8 md:h-12 w-auto"
                       width="auto"
                       height="auto" />
                  <img src="{% static 'logo.svg' %}"
                       alt="Re-Dcrypt"
                       class="h-8 md:h-12 w-auto"
                       width="auto"
                       height="auto" />
                </div>
                <div class="welcome-text">
                  <h2>
                    <span class="block text-white/80" id="welcomeText">Let's Log You In</span>
                  </h2>
                </div>
              </div>
            </div>
            <!-- Form Section -->
            <div class="md:w-[500px] flex-1"
                 data-aos="fade-up"
                 data-aos-duration="600">
              <form method="post"
                    action="{% url 'account_login' %}"
                    class="h-full"
                    id="login_form">
                {% csrf_token %}
                <div class="form-container h-full">
                  <div class="form-content p-6">
                    <div class="step-header flex flex-col items-center mb-8">
                      <span class="flex items-center justify-center w-12 h-12 rounded-full bg-green-600/20 text-green-500 mb-4">
                        <span class="material-symbols-outlined text-3xl">person</span>
                      </span>
                      <div class="text-center">
                        <h2 class="text-xl font-bold text-green-500">Welcome back!</h2>
                        <p class="text-neutral-400 text-sm mt-2">
                          Don't have an account?
                          <a href="{% url 'account_signup' %}"
                             class="text-green-500 hover:underline">Sign up</a>
                        </p>
                      </div>
                    </div>
                    <div class="form-fields"
                         data-aos="fade-up"
                         data-aos-delay="100"
                         data-aos-duration="600">
                      <div class="form-field">
                        <label for="id_login">Email or Username</label>
                        <div class="relative">
                          <input type="text" name="login" required placeholder="Username" />
                        </div>
                      </div>
                      <div class="form-field">
                        <div class="flex items-center justify-between">
                          <label for="id_password">Password</label>
                          <a href="{% url 'account_reset_password' %}"
                             class="text-green-500 hover:underline text-sm">Forgot Password?</a>
                        </div>
                        <div class="relative">
                          <input type="password"
                                 name="password"
                                 required
                                 placeholder="Password"
                                 id="id_password" />
                          <span class="material-symbols-outlined cursor-pointer text-xl absolute top-3 right-3 text-neutral-400"
                                id="togglePassword">visibility</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="form-buttons"
                       data-aos="fade-up"
                       data-aos-delay="200"
                       data-aos-duration="600">
                    <button type="submit"
                            class="w-full bg-neutral-900/70 shadow-inset-white hover:bg-green-600 text-neutral-100 hover:text-neutral-50 font-bold py-3 px-6 rounded-full transition-all duration-300 flex items-center justify-center gap-2">
                      <span class="material-symbols-outlined">login</span>
                      <span class="button-text">Login</span>
                    </button>
                    <p class="text-neutral-400 text-xs mt-4 text-center">
                      By logging in, you agree to Re-Dcrypt's
                      <a href="/terms-and-conditions/" class="text-green-500 hover:underline">Terms of Service</a>
                      and
                      <a href="/privacy-policy/" class="text-green-500 hover:underline">Privacy Policy</a>
                    </p>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
  const welcomeMessages = [
    "Ready to crack some codes?",
    "Back for more puzzles?",
    "The rabbit hole awaits...",
    "Time to decrypt the truth",
    "Your next challenge awaits",
    "Looks like someone's stuck",
    "Need those hints, eh?",
    "The matrix has you...",
    "Plot twist: This is level 0",
    "Forgot the password again?",
    "Hopefully you're not a bot",
    "Welcome back, detective",
    "Puzzle master returns!",
    "The game is afoot",
    "*cryptic noises intensify*",
  ];

  document.addEventListener("DOMContentLoaded", function () {
    const welcomeElements = document.querySelectorAll("#welcomeText");
    const randomMessage =
      welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
    welcomeElements.forEach((el) => (el.textContent = randomMessage));

    const form = document.getElementById("login_form");
    const togglePassword = document.getElementById("togglePassword");
    const passwordInput = document.getElementById("id_password");
    const submitBtn = form.querySelector('button[type="submit"]');
    const buttonText = submitBtn.querySelector(".button-text");

    form.addEventListener("submit", function (e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        showToast("Please fill in all required fields", 3000, "ERROR");
      } else {
        submitBtn.disabled = true;
        submitBtn.querySelector(".material-symbols-outlined").textContent =
          "autorenew";
        submitBtn
          .querySelector(".material-symbols-outlined")
          .classList.add("animate-spin");
        buttonText.textContent = "Logging in...";
      }
    });

    togglePassword.addEventListener("click", () => {
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        togglePassword.textContent = "visibility_off";
      } else {
        passwordInput.type = "password";
        togglePassword.textContent = "visibility";
      }
    });
  });
    </script>
    {% if form.errors %}
      <script>
  document.addEventListener('DOMContentLoaded', function() {
    {% for err in form.non_field_errors %}showToast("{{ err }}", 3000, 'ERROR');{% endfor %}
  });
      </script>
      {% for field in form %}
        {% for error in field.errors %}
          <script>
  document.addEventListener("DOMContentLoaded", function () {
    showToast("{{ error }}", 3000, "ERROR");
  });
          </script>
        {% endfor %}
      {% endfor %}
    {% endif %}
  {% endblock content %}
