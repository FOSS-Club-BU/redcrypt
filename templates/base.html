{% load static %}
{% load pwa %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>
      {% block head_title %}
      {% endblock head_title %}
    | Re-Dcrypt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-language" content="en-IN" />
    <meta name="title" content="Re-Dcrypt 2" />
    <meta name="description"
          content="A cryptic hunt in which you would face questions in any form. You need to use hints, Google & your out-of-the-box thinking skills to solve it." />
    <meta name="keywords" content="cryptic hunt, hunt, cryptic, steg, redcrypt" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="DiluteWater" />
    <meta name="theme-color" content="#08B74F" />
    <meta property="og:title" content="Re-Dcrypt 2" />
    <meta property="og:description"
          content="A cryptic hunt in which you would face questions in any form. You need to use hints, Google & your out-of-the-box thinking skills to solve it." />
    <meta property="og:image" content="/icons/maskable_icon_x192.png" />
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}" />
    {% progressive_web_app_meta %}
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              nblue: {
                DEFAULT: "#08B74F",
                50: "#8BFFFF",
                100: "#76FFFF",
                200: "#4DFFFF",
                300: "#25FFFF",
                400: "#00FBFB",
                500: "#08B74F",
                600: "#009A9A",
                700: "#006262",
                800: "#002A2A",
                900: "#000000",
              },
            },
            fontFamily: {
              Inter: ["Inter"],
            },
            boxShadow: {
              // inwards subtle white shadow to make it look neumorphic
              "inset-white": "inset 0 2px 0px -0.5px rgba(255, 255, 255, 0.1) ",
            },
          },
        },
      };
    </script>
    <script src="https://unpkg.com/@themesberg/flowbite@latest/dist/flowbite.bundle.js"></script>
    <script>
      (function (w, d, s, id) {
        if (typeof w.webpushr !== "undefined") return;
        w.webpushr =
          w.webpushr ||
          function () {
            (w.webpushr.q = w.webpushr.q || []).push(arguments);
          };
        var js,
          fjs = d.getElementsByTagName(s)[0];
        js = d.createElement(s);
        js.id = id;
        js.async = 1;
        js.src = "https://cdn.webpushr.com/app.min.js";
        fjs.parentNode.appendChild(js);
      })(window, document, "script", "webpushr-jssdk");
      webpushr("setup", {
        key: "BDV_66hjFZ-UmAPoFewcLdDHu3i2pPxgc-ZtBcDPesJqWM-SmAPBExtw1EhE1zzG7EuSuJje6Z42xAQqflvoFL4",
      });
    </script>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-79MBGTX27V"></script>
    <script type="text/javascript">
      (function (c, l, a, r, i, t, y) {
        c[a] =
          c[a] ||
          function () {
            (c[a].q = c[a].q || []).push(arguments);
          };
        t = l.createElement(r);
        t.async = 1;
        t.src = "https://www.clarity.ms/tag/" + i;
        y = l.getElementsByTagName(r)[0];
        y.parentNode.insertBefore(t, y);
      })(window, document, "clarity", "script", "di6ycvwqv4");
    </script>
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
          rel="stylesheet">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
    function showToast(message, time) {
      let toast = document.getElementById('custom_toast');
      toast.querySelector('span').innerHTML = message;
      toast.classList.add('show');

      setTimeout(function () {
        toast.classList.remove('show');
      }, time);
    }

    let userAgent = navigator.userAgent;
    if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
      showToast('Please use a chromium based browser or Firefox. You may experience some issues while using safari.', 5000)
    }
    </script>
    <style>
      body {
        background-color: #0a0a0a;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
      }

      .static-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
      }

      .install {
        display: none;
      }

      @media all and (display-mode: standalone) {
        .install {
          display: none;
        }
      }

    #custom_toast {
      visibility: hidden;
      opacity: 0;
      transition: all 0.5s;
      position: fixed;
      bottom: -999px;
      width: calc(100% - 2rem);
      max-width: 1200px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      justify-content: center;
      padding: 1rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 50;
    }

    #custom_toast.show {
      visibility: visible;
      opacity: 1;
      transition: all 0.5s;
      bottom: 1rem;
    }

    @media (max-width: 768px) {
      #custom_toast {
        width: calc(100% - 0.625rem);
        margin: 0;
        flex-direction: column;
        text-align: center;
        padding: 0.75rem;
      }
    }

      .promptPopup-show {
        background-color: rgba(0, 41, 41, 1);
        border: 1px solid #08b74f;
      }

          .button-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .button-container {
        flex-direction: column;
        align-items: stretch;
      }

      .button-container button {
        width: 100%;
      }
    }

      .webpushrOnBtn,
      .webpushrUnknownBtn {
        color: #08b74f;
      }

      #webpushrUnknownBtn {
        color: #002a2a;
      }

      popup_poweredby {
        display: none;
        opacity: 0;
        visibility: hidden;
      }

      #webpushrOnBtn {
        background-color: #b02323;
      }

      .webpushr-notification:hover {
        background-color: #08b74f;
        color: #002a2a;
      }

      popup_heading.popup-button-heading {
        border-top: 1px solid #08b74f;
      }

      webpushrwppromptbox2_wrapper {
        border-width: 2px;
        border-color: #08b74f;
      }

      #webpushr-subscription-button {
        display: block;
        padding-top: 1rem;
        padding-bottom: 1rem;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        color: #08b74f;
        background-color: transparent;
      }

      .font-Inter {
        font-feature-settings: "cv02", "cv03", "cv04", "cv11";
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
    </style>
    {% block head %}
    {% endblock head %}
  </head>
  <body class="font-Inter mt-24">
    <!-- Container for stacking multiple toasts -->
    <div id="toast_container"
         class="fixed bottom-0 right-0 flex w-full flex-col items-center p-4 space-y-2 z-50"></div>
    <div class="static-bg">
      <svg width="100%" height="100%" viewBox="0 0 800 800">
        <defs>
        <filter id="bb-filter" x="-100%" y="-100%" width="400%" height="400%">
        <feGaussianBlur stdDeviation="105" in="SourceGraphic" result="blur"></feGaussianBlur>
        </filter>
        </defs>
        <g filter="url(#bb-filter)">
        <ellipse rx="277.5" ry="70.5" cx="374" cy="152" fill="#08b74f">
        </ellipse>
        <ellipse rx="277.5" ry="70.5" cx="609" cy="577" fill="#2e90fa">
        </ellipse>
        <ellipse rx="277.5" ry="70.5" cx="569" cy="421" fill="#08B74F">
        </ellipse>
        <ellipse rx="277.5" ry="70.5" cx="580" cy="245" fill="#08B74F">
        </ellipse>
        </g>
      </svg>
    </div>
    {% if user.is_authenticated %}
      {% include "auth_header.html" %}
    {% else %}
      {% include "no_auth_header.html" %}
    {% endif %}
    <center>
      {% block content %}
      {% endblock content %}
      <div id="custom_toast"
           class="fixed bottom-0 text-sm rounded-2xl bg-neutral-900/70 backdrop-blur-xl shadow-inset-white text-neutral-100 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg"
             fill="none"
             viewBox="0 0 24 24"
             stroke-width="1.5"
             stroke="currentColor"
             class="w-6 h-6 text-amber-400">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
        <span></span>
      </div>
    </center>
    <script src="https://unpkg.com/flowbite@1.4.7/dist/flowbite.js"></script>
    {% if user.is_authenticated %}
      <script>
      let deferredPrompt;
      const addBtn = document.getElementById('installapp');
      addBtn.classList.add("hidden")
      window.addEventListener('beforeinstallprompt', function (e) {
        deferredPrompt = e;
        addBtn.classList.remove("hidden")
      });

      addBtn.addEventListener('click', async () => {
        console.log(deferredPrompt)
        if (deferredPrompt !== undefined) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') {
            showToast('Installing Re-Dcrypt', 2000)
            deferredPrompt = undefined;
          }
          else {
            showToast('Installation cancelled ', 2000)
            deferredPrompt = undefined;
          }
        } else {
          showToast('Re-Dcrypt App may be already installed or could not be installed. Please try again later or contact the admin', 2500)
        }
      });
      {% endif %}
      </script>
      {% block scripts %}
      {% endblock scripts %}
      <script>
      const options = { color: 'rgb(0, 210, 210)', zIndex: '-1' };
      {% if user.is_authenticated %}
      webpushr('attributes', { "username": "{{user.username}}" });
      {% endif %}
      </script>
      <script type="text/javascript">
      window.$crisp = [];
      window.CRISP_WEBSITE_ID = "73cba040-9174-41dd-a9f8-77bbd9c90366";
      (function () {
        d = document;
        s = d.createElement("script");
        s.src = "https://client.crisp.chat/l.js";
        s.async = 1;
        d.getElementsByTagName("head")[0].appendChild(s);
      })();
      </script>
      {% if user.is_authenticated %}
        <script type="text/javascript">
      $crisp.push(["set", "user:nickname", ["{{user.username}}"]]);
      $crisp.push(["set", "user:email", ["{{user.email}}"]]);
        </script>
      {% endif %}
      <script>
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");
      const menuIconLines = mobileMenuButton.querySelectorAll("span");
      let isOpen = false;

      mobileMenuButton.addEventListener("click", () => {
        isOpen = !isOpen;
        if (isOpen) {
          mobileMenu.classList.remove("-translate-y-[150%]");
          menuIconLines[0].classList.add("rotate-45", "translate-y-1.5");
          menuIconLines[1].classList.add("-rotate-45", "-translate-y-1.5");
        } else {
          mobileMenu.classList.add("-translate-y-[150%]");
          menuIconLines[0].classList.remove("rotate-45", "translate-y-1.5");
          menuIconLines[1].classList.remove("-rotate-45", "-translate-y-1.5");
        }
      });

      // Close menu when clicking outside
      document.addEventListener("click", (e) => {
        if (
          isOpen &&
          !mobileMenu.contains(e.target) &&
          !mobileMenuButton.contains(e.target)
        ) {
          isOpen = false;
          mobileMenu.classList.add("-translate-y-[150%]");
          menuIconLines[0].classList.remove("rotate-45", "translate-y-1.5");
          menuIconLines[1].classList.remove("-rotate-45", "-translate-y-1.5");
        }
      });
      </script>
      <script>
      // Initialize AOS
      AOS.init({
        offset: 50,
        delay: 0,
        duration: 800,
        easing: 'ease-out-cubic',
        once: true,
        mirror: false,
        anchorPlacement: 'top-bottom'
      });
      </script>
      <script>
      function showToast(message, time) {
        let container = document.getElementById('toast_container');
        let toast = document.createElement('div');
        toast.classList.add(
          'text-sm', 'rounded-2xl', 'bg-neutral-900/70', 'backdrop-blur-xl',
          'shadow-inset-white', 'text-neutral-100', 'flex', 'items-center',
          'gap-2', 'px-3', 'py-2', 'transition-all', 'duration-500', 'justify-center',
        );
        toast.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-amber-400">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
          </svg>
          <span>${message}</span>
        `;
        container.appendChild(toast);
        setTimeout(() => {
          toast.remove();
        }, time);
      }
      </script>
    </body>
  </html>
